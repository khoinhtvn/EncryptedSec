name: AI Anomaly Detection Alert
type: any
index: .ds-ai-middle-filebeat-*
realert:
  minutes: 0

filter:
- exists:
    field: composite_score

alert:
- "email"

smtp_host: smtp.gmail.com
smtp_port: 587
smtp_ssl: false
from_addr: noreply-ai-alerts@security.local
smtp_auth_file: /opt/elastalert/smtp_auth.yml
email:
- ${RECIPIENT_EMAIL}

alert_subject: "Network Anomaly Detected - IP: {0} Score: {1}"
alert_subject_args:
- ip_address
- composite_score

alert_text: |
  Network Anomaly Detected
  
  IP Address: {0}
  Composite Score: {1}
  Detection Time: {2}
  
  Traffic Summary:
  Total Sessions: {3}
  Outgoing Connections: {4}
  Incoming Connections: {5}
  Bytes Sent: {6:,}
  Bytes Received: {7:,}
  Unique Destinations: {8}
  
  Investigate: https://localhost:8005/#/sessions?expression=ip=={0}

alert_text_args:
- ip_address
- composite_score
- "@timestamp"
- total_matching_sessions
- outgoing_connections  
- incoming_connections
- total_bytes_sent
- total_bytes_received
- unique_destinations