name: AI Anomaly Detection Alert
type: any
index: .ds-ai-middle-filebeat-*
realert:
  minutes: 5

filter:
- exists:
    field: composite_score

alert:
- "slack"

slack_webhook_url: "${SLACK_WEBHOOK_URL}"

alert_subject: "ğŸš¨ Network Anomaly Detected - IP: {0} (Score: {1})"
alert_subject_args:
- ip_address
- composite_score

alert_text: |
  ğŸ“ *Threat Details:*
  â€¢ IP Address: `{0}`
  â€¢ Composite Score: `{1}`
  â€¢ Detection Time: `{2}`
  
  ğŸ“Š *Traffic Analysis:*
  â€¢ Total Sessions: `{3:,}`
  â€¢ Outgoing Connections: `{4}`
  â€¢ Incoming Connections: `{5}`
  â€¢ Bytes Sent: `{6:,}`
  â€¢ Bytes Received: `{7:,}`
  â€¢ Unique Destinations: `{8}`
  
  ğŸ” *Investigation:*
  <https://localhost:8005/#/sessions?expression=ip=={0}|Click here for Arkime Analysis>
  
  âš ï¸ *Immediate Actions Required:*
  1. Investigate traffic patterns in Arkime
  2. Check for lateral movement indicators
  3. Validate if this is legitimate activity

alert_text_args:
- ip_address
- composite_score
- "@timestamp"
- total_matching_sessions
- outgoing_connections
- incoming_connections
- total_bytes_sent
- total_bytes_received
- unique_destinations